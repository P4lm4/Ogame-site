<!DOCTYPE html>
<html>
    <head>
        <title>Ogame</title>

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

        <link rel="stylesheet" href="style/general.css">
        <link rel="stylesheet" href="style/headers.css">
        <link rel="stylesheet" href="style/sidebar.css">
        <link rel="stylesheet" href="style/info.css">
        <link rel="stylesheet" href="style/iframe.css">
        <link rel="stylesheet" href="style/info.css">
        <link rel="stylesheet" href="style/info-other-main.css">

    </head>
    <body>
        <div class="header">
            <div class="left-section"></div>
            <div class="middle-section">
                <div class="header-resource-icon">
                    <img class="iron-icon" src="headers-pictures/iron-spin.gif">
                    <div id="iron">-</div>
                </div>
                <div class="header-resource-icon">
                    <img class="crystal-icon" src="headers-pictures/crystalG.gif">
                    <div id="crystal">-</div>
                </div>
                <div class="header-resource-icon">
                    <img class="energy-icon" src="headers-pictures/energy-spin.gif">
                    <div id="energy">-</div>
                </div>
            </div>
            <div class="right-section">
                <div class="header-avatar-image">
                    <div class="header-avatar-image-signout">
                        <a id="username" href="#" style="color: white; text-decoration: none;">-</a>
                        <a href="#" onclick="signOut()" style="color: white; text-decoration: none;">Sign out</a>
                    </div>
                    <img class="avatar-image" src="avatar-pictures/Avatar-pictures.png">
                </div>
            </div>
        </div>

        <div class="sidebar-left">
            <button id="b1" class="sidebar-button" onclick="changeTab('overview')">Overview</button>
            <button id="b2" class="sidebar-button" onclick="changeTab('resource')">Resource</button>
            <button id="b3" class="sidebar-button" onclick="changeTab('shipyard')">Shipyard</button>
            <button id="b4" class="sidebar-button" onclick="changeTab('fleet')">Fleet</button>
        </div>

        <div id="ownedPlanet" class="sidebar-right">
            <!--<button id="planetBtn" class="sidebar-link">
                <img class="planet-icon" src="headers-pictures/Planeta1.png">
                <div id="nameOfPlanet">-</div>
                <div id="coordinationOfPlanet">-</div>
            </button> -->
        </div>
        
        <div id="tabContainer" class="iframe-container">
            
        </div>


    </body>
    <script>

        var tabContainer = document.getElementById("tabContainer");

        async function changeTab(tabName) {
            const response = await fetch("http://127.0.0.1:5500/" + tabName + ".html");

            var data = await response.text();
            tabContainer.innerHTML = data;
        }

        changeTab("overview");

        var usernameLabel = document.getElementById("username");
        usernameLabel.innerHTML = localStorage.getItem("OG.username");
        

        async function reloadResource()
        {
            var iron = document.getElementById("iron");
            var crystal = document.getElementById("crystal");
            var energy = document.getElementById("energy");
            

            const response = await fetch(`http://127.0.0.1:8080/resource?token=${localStorage.getItem("OG.token")}&idPlanet=${localStorage.getItem("OG.planets")[0]}`);
            var data = await response.json();

            if(data.success)
            {
                iron.innerHTML = data.iron;
                crystal.innerHTML = data.crystal;
                energy.innerHTML = data.energyConsumption + " / " + data.energyProduction;
            }
            else
            {
                alert("Neuspijesno ucitani resursi! ");
            }
        }

        async function listOfOwnedPlanets()
        {

            var planetContainer = document.getElementById("ownedPlanet");

            const respons = await fetch(`http://127.0.0.1:8080/planets?token=${localStorage.getItem("OG.token")}`);
            var data = await respons.json();

            if(data.success)
            {

                planetContainer.innerHTML = "";

                for(var i = 0; i < data.ownedPlanets.length; i++)
                {

                    var planetButton = document.createElement("button");
                    planetButton.id = "planetBtn";
                    planetButton.className = "sidebar-link";

                    planetContainer.appendChild(planetButton);

                    var planetImg = document.createElement("img");
                    planetImg.className = "planet-icon";
                    planetImg.src = "headers-pictures/Planet" + ((data.ownedPlanets[i].id % 6) + 1) + ".png";

                    planetButton.appendChild(planetImg);

                    var planetName = document.createElement("div");
                    planetName.id = "nameOfPlanet";
                    planetName.innerHTML = data.ownedPlanets[i].name;

                    planetButton.appendChild(planetName);

                    var planetCoordinates = document.createElement("div");
                    planetCoordinates.id = "coordinationOfPlanet";
                    planetCoordinates.innerHTML = data.ownedPlanets[i].positionX + " / " + data.ownedPlanets[i].positionY;

                    planetButton.appendChild(planetCoordinates);

                }
                
            }

        }

        async function signOut()
        {

            const respons = await fetch(`http://127.0.0.1:8080/signOut?token=${localStorage.getItem("OG.token")}`);
            var data = await respons.json();

            if(data.success)
            {
                localStorage.clear();
                alert("Uspijesno ste izlogovani! ");
                location.href = "http://127.0.0.1:5500/login.html";
            }
            else
            {
                alert("Niste se uspijeli izlogovati! ")
            }

        }

        reloadResource();

        listOfOwnedPlanets();




    </script>
</html>